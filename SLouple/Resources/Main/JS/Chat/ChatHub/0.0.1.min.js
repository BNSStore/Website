var chatHub=function(){function e(n,r,u,f){var e=i.clone(),o;u=="xx"?(e.addClass("message-type-"+u),e.find(".message-date").text(f),e.find(".message-display-name").text(t(n)),e.find(".message-context").text(t(r)+": "),e.find(".message-context").insertBefore(e.find(".message-display-name"))):(e.addClass("message-type-"+u),e.find(".message-date").text(f),e.find(".message-display-name").text(n),e.find(".message-context").text(r));e.css("opacity","0");$("#chat-log").append(e);e.velocity({opacity:1},300);o=document.getElementById("chat-log");o.scrollTop=o.scrollHeight}function t(n){return $("<div />").text(n).html()}function o(n){$("#online-users").text("");n.forEach(function(n){$("#online-users").append('<div class="online-user">'+t(n)+"<\/div>")});$(".online-user").autoTextSize(.5,0,$("#online-users-container"),!0)}function r(){var r,t,i;$("#connecting-title").css("display","none");$("#logging-in-title").css("display","block");r=f("userID");t=f("sessionToken");r!=null&&t!=null&&t!=""&&(n.server.login(r,t),i=document.createElement("style"),i.type="text/css",i.innerHTML=".message-own{ background: #eab71c; color: black }",document.body.appendChild(i))}function u(){$("#message").val()!=""&&(n.server.sendMessage($("#message").val()),$("#message").val("").focus())}function f(n){for(var t,r=n+"=",u=document.cookie.split(";"),i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""}var i,n;return $(function(){i=$("#message-entry-clone");$("#account-warning-title").text()==""&&($("#chat-log").autoTextSize(1.2,0,$("#chat-hub-container"),!1,{maxFontSize:"30px"}),$("#message-send-button").autoTextSize(.12,0,null,!1),$("#message").autoTextSize(.15,0,null,!1),n=$.connection.chatHub,n.client.recieveMessage=e,n.client.updateOnlineUserList=o,n.connection.start().done(function(){r();$("#message-send-button").click(function(){u()});$("#message").keypress(function(n){var t=n.which;t==13&&u()});$("#state-container").css("display","none")}),n.connection.disconnected(function(){setTimeout(function(){n.connection.start().done(function(){r()})},2e3)}))}),window.onbeforeunload=function(){return n.connection.stop(),null},n}();